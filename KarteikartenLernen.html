<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Karteikarten Lernseite</title>
    <style>
    html, body { height: 100%; }
    
    #flashcard {
      text-align: center; /* Zentriert den Inhalt horizontal */
    }
    
    hr {
      border: none;
      border-top: 1px solid #000; /* Fügt einen horizontalen Strich ein */
    }

    table { 
      border-collapse: collapse; width: 100%; 
    }
    
    th, td {
      border: 1px solid #000;
      padding: 8px;
      text-align: left;
    }
    
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    
    .button-container {
      text-align: center; /* Zentriert den Container horizontal */
    }
    
    .button-container button {
      display: inline-block; /* Zeigt die Buttons nebeneinander an */
      margin: 10px; /* Fügt Abstand zwischen den Buttons hinzu */
      padding: 10px 20px; /* Ändert die Polsterung, um die Größe zu erhöhen */
      font-size: 16px; /* Ändert die Schriftgröße */
    }
    
    .active {
      background-color: #007bff; /* Ändert die Hintergrundfarbe im aktivierten Zustand */
      color: #fff; /* Ändert die Textfarbe im aktivierten Zustand */
    }
    
    .wrapper {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .content {
      flex: 1;
    }
    
    footer {
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 10px 0;
    }
    
    .footer-content {
      max-width: 800px;
      margin: 0 auto;
    }
    /* CSS für das Modal */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 20px;
        width: 80%;
        border-radius: 5px;
    }
     
    .input-group {
      margin-bottom: 20px;
    }

    textarea {
      width: 100%;
    }
    </style>
    <!-- MathJax-Konfiguration im head-Bereich -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            }
        });
    </script>
    
    <!-- MathJax-Script im head-Bereich -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
    <div class="wrapper">
    <div class="content">
    <h1>Meine Karteikarten</h1>
    <div id="flashcard">
        <div id="question">
            Frage hier
        </div>
        <hr> <!-- Horizontaler Strich -->
        <div id="answer">
            Antwort hier
        </div>
    </div>
    <div class="button-container">
	    <button id="showAnswer">Antwort anzeigen</button>
	    <button id="nextCard">Nächste Karte</button>
    </div>
    <button id="shuffleCards">Karteikarten mischen</button>
    <button id="showAllCards">Alle Karteikarten anzeigen</button>
    <button id="showFileOptions">Dateiaktionen</button>
    <button id="openModalButton">Karteikarte hinzufügen/bearbeiten</button>

    <div id="fileHandling" style="display: none; margin-top: 20px; margin-bottom: 20px;">
      <input type="file" id="fileInput">
      <button id="downloadButton">Flashcards als CSV herunterladen</button>
      <a id="downloadLink" style="display: none" download="flashcards.csv" href="data:text/csv;charset=utf-8,"></a>
    </div>
    
    <div id="flashcardView" style="display: none; margin-top: 20px; margin-bottom: 20px;">
        <table>
            <thead>
                <tr>
                    <th>Fragen</th>
                    <th>Antworten</th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody id="flashcardTableBody">
                <!-- Hier werden die Karteikarten eingefügt -->
            </tbody>
        </table>
    </div>
    </div> <!-- Ende von Hauptinhalt (content) - noetig fuer wrapper  -->
    <!-- Modal -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span id="closeModalButton" style="float: right; cursor: pointer;">Schließen [X]</span>
        <!-- Hier kannst du das Formular zum Bearbeiten oder Hinzufügen von Karteikarten platzieren -->
        <form id="editCardForm">
          <!-- Frage-Eingabefeld -->
          <div class="input-group">
            <label for="modalQuestion">Frage:</label>
            <textarea id="modalQuestion" name="modalQuestion" rows="4" style="width: 100%;" required></textarea>
          </div>

          <!-- Antwort-Eingabefeld -->
          <div class="input-group">
            <label for="modalAnswer">Antwort:</label>
            <textarea id="modalAnswer" name="modalAnswer" rows="4" style="width: 100%;" required></textarea>
          </div>
          
          <input type="submit" value="Speichern">
          <!-- Buttons für die Navigation -->
          <button type="button" id="modalPreviousCardButton">Vorherige Karteikarte</button>
          <button type="button" id="modalNextCardButton">Nächste Karteikarte</button>
          <button type="button" id="modalNewCardButton">Neue Karteikarte</button>
          <button type="button" id="modalDuplicateCardButton">Duplizieren</button>

        </form>
        <!-- Erfolgsmeldung -->
        <div id="modalSuccessMessage" style="display: none; color: green; margin-top: 10px;">Die Karteikarte wurde erfolgreich gespeichert!</div>

      </div>
    </div>
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <p>    <div id="dataCount">Anzahl der Datensätze: 0</div></p>
            <p>Allgemeine Informationen: Hier findest du nützliche Informationen.</p>
        </div>
    </footer>
    </div> <!-- Wrapper endet hier - nötig damit footer unten -->
    <!-- Script-Bereich -->
    <script>
    // Lies den Query-Parameter 'file' aus der URL oder verwende einen Standardwert
    const urlParams = new URLSearchParams(window.location.search);
    const csvFile = urlParams.has('file') ? urlParams.get('file') : 'karteikarten.csv';

    // Funktion zum Lesen von CSV in ein Array
    function parseCSV(csv) {
	    const result = [];

      const lines = csv.split('\n');
      //const headers = lines[0].split(',');
      for (let i = 0; i < lines.length; i++) {
        const currentLine = lines[i].split(',');
        if (currentLine.length >= 2) {
          const questiontext = currentLine[0] ? currentLine[0].trim() : '';
          const answertext = currentLine[1] ? currentLine[1].trim() : '';
          if (questiontext !== '' || answertext !== '') {
            const card = { question: questiontext, answer: answertext };
            result.push(card);
          }
        }
      }

      return result;
    }

    const questionElement = document.getElementById('question');
    const answerElement = document.getElementById('answer');
    const showAnswerButton = document.getElementById('showAnswer');
    const nextCardButton = document.getElementById('nextCard');
    const dataCountElement = document.getElementById('dataCount');

    showAnswerButton.addEventListener('click', () => {
      answerElement.style.display = 'block';
    });

    nextCardButton.addEventListener('click', () => {
      currentCard = (currentCard + 1) % flashcards.length;
      showFlashcard();
    });

    let currentCard = 0;
    let flashcards = [];

    // Funktion zum Laden der CSV-Datei
    function loadCSVFile(url) {
        fetch(url)
          .then(response => {
            if (!response.ok) {
           		throw new Error('Fehler beim Laden der Datei: ' + response.status);
       	    }
            return response.text();
          })
          .then(data => {
            flashcards = parseCSV(data);
            // Update Counter und currentCard
            showFlashcard();
            updateDataCount(flashcards.length);
            renderAllFlashcards();
          })
          .catch(error => {
            // Hier wird der Fehler behandelt und dem Benutzer eine Fehlermeldung angezeigt
            console.error('Fehler beim Laden der CSV-Datei: ' + error);
            alert('Die Datei konnte nicht gefunden oder geladen werden. Bitte überprüfen Sie die URL.');
          });
    }
    
    //Funktion zum laden einer lokalen Datei
    const fileInput = document.getElementById('fileInput');
        
    fileInput.addEventListener('change', function() {
      const selectedFile = fileInput.files[0];
      if (selectedFile) {
        console.log('Ausgewählte Datei:', selectedFile);
        // Hier kannst du den ausgewählten Dateiinhalt verarbeiten
        const reader = new FileReader();

        reader.onload = function(event) {
          const fileContent = event.target.result;
          // Hier hast du den Inhalt der CSV-Datei in der Variablen 'fileContent'
          // Jetzt kannst du den Inhalt weiterverarbeiten und die Karteikarten erstellen oder ersetzen.
          flashcards = parseCSV(fileContent);
          showFlashcard();
          updateDataCount(flashcards.length);
          renderAllFlashcards();
        };

        reader.readAsText(selectedFile);
      }
    });

    // Funktionalität zum herunterladen der Karten als csv-Datei
    const downloadButton = document.getElementById('downloadButton');
    const downloadLink = document.getElementById('downloadLink');

    downloadButton.addEventListener('click', function() {
      const csvContent = flashcards.map(card => `${card.question},${card.answer}`).join('\n');

      downloadLink.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
      downloadLink.style.display = 'block';
      downloadLink.click();
    });

    // Funktion zum Anzeigen der aktuellen Karte
    function showFlashcard() {
      if (currentCard > flashcards.length-1) {
        currentCard = 0;
      }
      if (flashcards[currentCard]) {
        questionElement.innerText = flashcards[currentCard].question;
        answerElement.innerText = flashcards[currentCard].answer;
        answerElement.style.display = 'none';
        // Nachdem die neue Karteikarte geladen wurde, rufe MathJax auf, um die LaTeX-Syntax in dieser Karteikarte zu übersetzen.
        // Hier wird "questionElement" verwendet, um die LaTeX-Syntax in der Frage der Karteikarte zu übersetzen
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, questionElement]); 
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, answerElement]); 
      }
    }

    // Zufällige Reihenfolge der Karten
    function shuffleCards() {
      for (let i = flashcards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [flashcards[i], flashcards[j]] = [flashcards[j], flashcards[i]];
      }
    }

    // Funktion zum Aktualisieren der Datensatzanzahl
    function updateDataCount(count) {
      dataCountElement.innerText = `Anzahl der Datensätze: ${count}`;
    }

    // Lade die CSV-Datei (wird weiter oben definiert)
    loadCSVFile(csvFile);

    // Button für das Mischen
    const shuffleCardsButton = document.getElementById('shuffleCards');
    shuffleCardsButton.addEventListener('click', shuffleCards);

    // hier kommt der Bereich zum Anzeigen aller Karteikarten
    const showAllCardsButton = document.getElementById('showAllCards');
    const flashcardView = document.getElementById('flashcardView');
    const flashcardTableBody = document.getElementById('flashcardTableBody');
    
    showAllCardsButton.addEventListener('click', toggleAllCardsView);

    let isAllCardsViewVisible = false;

    function toggleAllCardsView() {
      isAllCardsViewVisible = !isAllCardsViewVisible;
      if (isAllCardsViewVisible) {
        showAllCardsButton.classList.add('active');
        flashcardView.style.display = 'block';
        renderAllFlashcards();
      } else {
        showAllCardsButton.classList.remove('active');
        flashcardView.style.display = 'none';
      }
    }

    // hier kommt der Bereich zum Anzeigen der Dateiaktionen
    const showFileOptionsButton = document.getElementById('showFileOptions');
    const fileHandling = document.getElementById('fileHandling');

    showFileOptionsButton.addEventListener('click', toggleFileHandlingView);

    let isFileHandlingVisible = false;

    function toggleFileHandlingView() {
      isFileHandlingVisible = !isFileHandlingVisible;
      if (isFileHandlingVisible) {
        showFileOptionsButton.classList.add('active');
        fileHandling.style.display = 'block';
      } else {
        showFileOptionsButton.classList.remove('active');
        fileHandling.style.display = 'none';
      }
    }

    function renderAllFlashcards() {
      if (isAllCardsViewVisible) {
        flashcardTableBody.innerHTML = ''; // Leert die Tabelle

        // Schleife durch alle Karteikarten und füge sie zur Tabelle hinzu
        for (let i = 0; i < flashcards.length; i++) {
          const card = flashcards[i];
          const row = document.createElement('tr');
          const questionCell = document.createElement('td');
          const answerCell = document.createElement('td');
          const actionsCell = document.createElement('td');
          
          questionCell.textContent = card.question;
          answerCell.textContent = card.answer;

          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Löschen';
          deleteButton.className = 'delete-card';
          deleteButton.setAttribute('data-card-id', i); // Eindeutige Kartenkennung
          deleteButton.style.marginRight = '10px'; // Beispiel: 10px Abstand zwischen den Buttons

          const editButton = document.createElement('button');
          editButton.textContent = 'Bearbeiten';
          editButton.className = 'edit-card';
          editButton.setAttribute('data-card-id', i); // Eindeutige Kartenkennung
    
          actionsCell.appendChild(deleteButton);
          actionsCell.appendChild(editButton);

          row.appendChild(questionCell);
          row.appendChild(answerCell);
          row.appendChild(actionsCell);

          flashcardTableBody.appendChild(row);
        }
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, flashcardTableBody]); // Hier MathJax über die Tabelle auslösen
      }
    }
    
    // Funktion zum Löschen einer Karte
    function deleteCard(cardId) {
        // Hier kannst du die Logik zum Löschen der Karte implementieren, z. B.:
        // cardData.splice(cardId, 1); // Entferne die Karte aus deinem Datenarray
        flashcards.splice(cardId,1);
        updateDataCount(flashcards.length);
        // Rufe die Funktion zum Aktualisieren der Tabelle auf
        renderAllFlashcards();
    }

    // Eventlistener für Löschen-Buttons
    document.querySelector('table').addEventListener('click', function (e) {
        if (e.target && e.target.matches('button.delete-card')) {
          const cardId = e.target.getAttribute('data-card-id');
          deleteCard(cardId);
        } else if (e.target && e.target.matches('button.edit-card')) {
          const cardId = e.target.getAttribute('data-card-id');
          modalCurrentCardIndex = cardId;
          modal.style.display = 'block';
          modalDisplayCurrentCard();
        }
    });
    
    // JavaScript-Code zum Öffnen und Schließen des Modals
    const openModalButton = document.getElementById('openModalButton');
    const modal = document.getElementById('modal');
    const closeModalButton = document.getElementById('closeModalButton');
    const editCardForm = document.getElementById('editCardForm');
    const questionInput = document.getElementById('modalQuestion');
    const answerInput = document.getElementById('modalAnswer');
    let modalCurrentCardIndex = 0; // Index der aktuellen Karteikarte

    openModalButton.addEventListener('click', function() {
      //Modal anzeigen
      modal.style.display = 'block';
      //Mit Karte füllen
      modalDisplayCurrentCard();
    });

    closeModalButton.addEventListener('click', function() {
      modal.style.display = 'none';
    });
    
    editCardForm.addEventListener('submit', function(event) {
      //Die Standard-Formularübermittlung wird verhindert
      event.preventDefault();
      // Hier kannst du die bearbeiteten Daten speichern oder verarbeiten
      const editedCard = {
          question: questionInput.value,
          answer: answerInput.value
      };
      if (modalCurrentCardIndex >= 0 && modalCurrentCardIndex < flashcards.length) {
        flashcards[modalCurrentCardIndex]=editedCard;
        renderAllFlashcards();
      } else {
        flashcards.push(editedCard);
        updateDataCount(flashcards.length);
        modalCurrentCardIndex = flashcards.length-1;
        renderAllFlashcards();
      }
      showSuccessMessage();
      console.log('Bearbeitete Karteikarte:', editedCard);
    });

    // Funktion, um die Erfolgsmeldung anzuzeigen
    function showSuccessMessage() {
        const successMessage = document.getElementById('modalSuccessMessage');
        successMessage.style.display = 'block';

        // Optional: Du kannst die Erfolgsmeldung nach ein paar Sekunden automatisch ausblenden
        setTimeout(function() {
            successMessage.style.display = 'none';
        }, 3000); // Beispiel: 3000 Millisekunden (3 Sekunden)
    }

    // Funktion zum Anzeigen der aktuellen Karteikarte
    function modalDisplayCurrentCard() {
      if (modalCurrentCardIndex >= 0 && modalCurrentCardIndex < flashcards.length) {
        const currentCard = flashcards[modalCurrentCardIndex];
        questionInput.value = currentCard.question;
        answerInput.value = currentCard.answer;
      } else {
        questionInput.value = '';
        answerInput.value = '';
      }
    }
    
    
    // Eventlistener für den "Vorherige Karteikarte"-Button
    const modalPreviousCardButton = document.getElementById('modalPreviousCardButton');
    modalPreviousCardButton.addEventListener('click', function() {
      //Die Standard-Formularübermittlung wird verhindert
      event.preventDefault();
      if (modalCurrentCardIndex > 0) {
          modalCurrentCardIndex--;
          modalDisplayCurrentCard();
      } else {
        modalCurrentCardIndex = 0;
      }
    });

    // Eventlistener für den "Nächste Karteikarte"-Button
    const modalNextCardButton = document.getElementById('modalNextCardButton');
    modalNextCardButton.addEventListener('click', function() {
      //Die Standard-Formularübermittlung wird verhindert
      event.preventDefault();
      if (modalCurrentCardIndex < flashcards.length - 1) {
          modalCurrentCardIndex++;
          modalDisplayCurrentCard();
      }
    });

    // Eventlistener für den "Neue Karteikarte"-Button
    const modalNewCardButton = document.getElementById('modalNewCardButton');
    modalNewCardButton.addEventListener('click', function() {
      //Die Standard-Formularübermittlung wird verhindert
      event.preventDefault();
      modalCurrentCardIndex=-1;
      modalDisplayCurrentCard();
    });

    // Eventlistener für den "Duplizieren"-Button
    const modalDuplicateCardButton = document.getElementById('modalDuplicateCardButton');
    modalDuplicateCardButton.addEventListener('click', function() {
      //Die Standard-Formularübermittlung wird verhindert
      event.preventDefault();
      modalCurrentCardIndex=-1;
    });

    // Schließe das Modal, wenn der Benutzer außerhalb des Modals klickt
    window.addEventListener('click', function(event) {
      if (event.target == modal) {
          modal.style.display = 'none';
      }
    });
  </script>
</body>
</html>

